<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="CiderTogether.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CiderTogether"
    xmlns:views="using:CiderTogether.Views"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    Title="Cider Together">

    <Grid>
        <!-- Blurred artwork background using Win2D -->
        <canvas:CanvasControl x:Name="BlurCanvas"
                              Draw="BlurCanvas_Draw"
                              Visibility="Collapsed"/>

        <!-- Dark overlay -->
        <Rectangle x:Name="BackgroundOverlay"
                   Fill="Black"
                   Opacity="0.35"
                   Visibility="Collapsed"/>

        <!-- Main content area -->
        <Grid x:Name="ContentRoot">
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/> <!-- Title bar area -->
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="*"/> <!-- Main content -->
            </Grid.RowDefinitions>

            <!-- Custom title bar area -->
            <Grid x:Name="AppTitleBar" Grid.Row="0" VerticalAlignment="Stretch">
                <TextBlock x:Name="AppTitleTextBlock"
                           Text="Cider Together"
                           VerticalAlignment="Center"
                           Margin="12,0,0,0"
                           Style="{StaticResource CaptionTextBlockStyle}"/>
            </Grid>

            <!-- Header with status -->
            <Grid Grid.Row="1" Padding="20,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title and connection status -->
                <StackPanel Grid.Column="0" Spacing="2">
                    <TextBlock Text="Cider Together"
                               Style="{StaticResource SubtitleTextBlockStyle}"/>
                    <StackPanel x:Name="ConnectionStatus"
                                Orientation="Horizontal"
                                Spacing="4"
                                Visibility="Collapsed">
                        <Ellipse Width="6" Height="6" Fill="LimeGreen"/>
                        <TextBlock Text="Connected"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Header actions -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="4">
                    <!-- Room actions (when in room) -->
                    <StackPanel x:Name="RoomActions"
                                Orientation="Horizontal"
                                Spacing="4"
                                Visibility="Collapsed">
                        <Button x:Name="MinimizeToTrayButton"
                                ToolTipService.ToolTip="Move to System Tray"
                                AutomationProperties.Name="Move to System Tray"
                                Click="MinimizeToTray_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8">
                            <FontIcon Glyph="&#xE921;" FontSize="14"/>
                        </Button>
                        <Button x:Name="LeaveRoomButton"
                                ToolTipService.ToolTip="Leave Room"
                                AutomationProperties.Name="Leave Room"
                                Click="LeaveRoom_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8">
                            <FontIcon Glyph="&#xE7E8;" FontSize="14"/>
                        </Button>
                    </StackPanel>

                    <!-- Menu button -->
                    <Button x:Name="MenuButton"
                            ToolTipService.ToolTip="Menu"
                            AutomationProperties.Name="Menu"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="8">
                        <FontIcon Glyph="&#xE712;" FontSize="14"/>
                        <Button.Flyout>
                            <MenuFlyout Placement="BottomEdgeAlignedRight">
                                <MenuFlyoutItem Text="About Cider Together"
                                                Click="About_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE946;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutItem Text="Acknowledgments"
                                                Click="Acknowledgments_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE8D4;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutItem Text="Help (GitHub)"
                                                Click="Help_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE897;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutItem Text="Debug"
                                                Click="Debug_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xEBE8;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutItem Text="Quit"
                                                Click="Quit_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE8BB;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Main scrollable content -->
            <ScrollViewer Grid.Row="2"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <Frame x:Name="ContentFrame" Padding="20"/>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>

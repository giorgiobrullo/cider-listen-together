<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="CiderTogether.Views.HomeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CiderTogether.Controls">

    <Grid>
        <!-- Connected State -->
        <StackPanel x:Name="ConnectedPanel"
                    Spacing="24"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="Collapsed">

            <!-- Cider Warning Banner -->
            <InfoBar x:Name="CiderWarningBanner"
                     IsOpen="False"
                     Severity="Warning"
                     Title="Connection issue"
                     Message="Retrying automatically..."
                     IsClosable="False"
                     MaxWidth="280">
                <InfoBar.ActionButton>
                    <Button Content="Retry" Click="RetryConnection_Click"/>
                </InfoBar.ActionButton>
            </InfoBar>

            <!-- Now Playing Card -->
            <controls:NowPlayingCard x:Name="NowPlayingCardControl"/>

            <!-- Action Buttons -->
            <StackPanel Spacing="10" Width="280">
                <Button Style="{StaticResource AccentButtonStyle}"
                        HorizontalAlignment="Stretch"
                        Click="CreateRoom_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;" FontSize="16"/>
                        <TextBlock Text="Create Room"/>
                    </StackPanel>
                </Button>
                <Button HorizontalAlignment="Stretch"
                        Click="JoinRoom_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE902;" FontSize="16"/>
                        <TextBlock Text="Join Room"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Display Name -->
            <StackPanel Spacing="4" Width="280">
                <TextBlock Text="Your Name"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <Grid ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="DisplayNameTextBox"
                             PlaceholderText="Display Name"
                             TextChanged="DisplayName_TextChanged"/>
                    <Button Grid.Column="1"
                            ToolTipService.ToolTip="Settings"
                            Click="Settings_Click">
                        <FontIcon Glyph="&#xE713;" FontSize="16"/>
                    </Button>
                </Grid>
            </StackPanel>
        </StackPanel>

        <!-- Disconnected State -->
        <StackPanel x:Name="DisconnectedPanel"
                    Spacing="20"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="Visible">

            <!-- Checking Connection -->
            <StackPanel x:Name="CheckingConnectionPanel"
                        Spacing="16"
                        HorizontalAlignment="Center"
                        Visibility="Collapsed">
                <ProgressRing IsActive="True" Width="48" Height="48"/>
                <TextBlock Text="Connecting to Cider..."
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Not Connected -->
            <StackPanel x:Name="NotConnectedPanel"
                        Spacing="20"
                        HorizontalAlignment="Center"
                        Visibility="Visible">
                <FontIcon Glyph="&#xE8D6;"
                          FontSize="48"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                          HorizontalAlignment="Center"/>

                <StackPanel Spacing="6" HorizontalAlignment="Center">
                    <TextBlock x:Name="ConnectionTitle"
                               Text="Connect to Cider"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"/>
                    <TextBlock x:Name="ConnectionSubtitle"
                               Text="Make sure Cider is running with API access enabled."
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="260"/>
                </StackPanel>

                <!-- Setup Fields -->
                <StackPanel Spacing="12" Width="260">
                    <StackPanel Spacing="4">
                        <TextBlock Text="API Token"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <PasswordBox x:Name="ApiTokenBox"
                                     PlaceholderText="Paste your Cider API token"
                                     PasswordChanged="ApiToken_PasswordChanged"/>
                    </StackPanel>

                    <StackPanel Spacing="4">
                        <TextBlock Text="Your Name"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBox x:Name="SetupDisplayNameBox"
                                 PlaceholderText="Display name"
                                 TextChanged="SetupDisplayName_TextChanged"/>
                    </StackPanel>
                </StackPanel>

                <Button Content="Connect"
                        Style="{StaticResource AccentButtonStyle}"
                        Width="260"
                        Click="Connect_Click"/>

                <!-- Connection Error -->
                <TextBlock x:Name="ConnectionErrorText"
                           Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           TextAlignment="Center"
                           TextWrapping="Wrap"
                           MaxWidth="260"
                           Visibility="Collapsed"/>
            </StackPanel>
        </StackPanel>

        <!-- Join Room Dialog -->
        <ContentDialog x:Name="JoinRoomDialog"
                       Title="Join a Room"
                       PrimaryButtonText="Join"
                       CloseButtonText="Cancel"
                       DefaultButton="Primary"
                       PrimaryButtonClick="JoinRoomDialog_PrimaryButtonClick">
            <StackPanel Spacing="16" MinWidth="240">
                <TextBlock Text="Enter the room code"
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBox x:Name="RoomCodeTextBox"
                         PlaceholderText="XXXX-XXXX"
                         TextAlignment="Center"
                         MaxLength="9"
                         CharacterSpacing="100"
                         CharacterCasing="Upper"
                         TextChanged="RoomCode_TextChanged"/>
                <TextBlock x:Name="RoomCodeValidation"
                           Text="Enter 8 characters (letters and numbers)"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource SystemFillColorCautionBrush}"
                           Visibility="Collapsed"/>
            </StackPanel>
        </ContentDialog>

        <!-- Settings Dialog -->
        <ContentDialog x:Name="SettingsDialog"
                       Title="Settings"
                       PrimaryButtonText="Save"
                       CloseButtonText="Cancel"
                       DefaultButton="Primary"
                       PrimaryButtonClick="SettingsDialog_PrimaryButtonClick">
            <StackPanel Spacing="16" MinWidth="300">
                <StackPanel Spacing="6">
                    <TextBlock Text="Cider API Token"
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Find this in Cider: Settings > Connectivity > Manage External Application Access"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextWrapping="Wrap"/>
                    <PasswordBox x:Name="SettingsApiTokenBox"
                                 PlaceholderText="API Token (optional)"/>
                </StackPanel>

                <StackPanel Spacing="6">
                    <TextBlock Text="Display Name"
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBox x:Name="SettingsDisplayNameBox"
                             PlaceholderText="Your name"/>
                </StackPanel>
            </StackPanel>
        </ContentDialog>
    </Grid>
</Page>
